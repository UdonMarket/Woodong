<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper  namespace="model.MypageDAOImpl" > 
	
	<!-- 우동좌측이미지 -->
	<!-- id마다 평점불러오기 -->
	<select id="review_score" resultType="String"> 
		select review_score from woo_board where id = #{0}
	</select>
	<!-- avg-score update -->
	<update id="avg_score_update">
		update woo_member set avg_score = #{0}
	</update>
	
	
	<select id="myInfo" resultType="model.MemberVO">
 		select * from woo_member where id=#{0}
 	</select>


	<!-- 카테고리에서 좋아요 누를 때 -->
	<!--ㅡmypage goods에 연결된 String 가져오기 -->	
	 <select id="selectLike" resultType="String">
	 	select goods from mypage where id = #{0}
	 </select>
	 
	 <!--ㅡmypage goods에 새로운 idx update -->	
	<update id="updateLike" >
 		update mypage set goods = #{0} where id = #{1}
 	</update>


	<!-- 좋아요 토글 -->
  	<update id="likeCheck">
  		update WOO_BOARD set like_check = -like_check where idx = #{0}
  	</update>
  	
  	<!-- likeCheck select -->
  	<select id="selectLikeCheck" resultType="int">
  		select like_check from WOO_BOARD where idx = #{0}
  	</select>
  	
  	<update id="likeCount_minus">
  		update woo_board set likecount = likecount -1 where idx = #{1}
  	</update>
  	<update id="likeCount_puls">
  		update woo_board set likecount = likecount +1 where idx = #{1}
  	</update>

	 
	 
	 <select id="selectBoard" resultType="model.WooBoardVO" parameterType="model.ParameterVO"> 
  		SELECT * FROM (
  			SELECT Tb.*, rownum rNum FROM(
  				SELECT * FROM WOO_BOARD
  					WHERE 1=1
  			<!-- 거래중 -->	
  			<if test="mode.equals('deal')">
  				and escrow = 'true'
  					<!-- 거래중 & 판매목록 -->	
  				<if test="dealMode.equals('sell')">
  					and id = #{user_id} 
  				</if>
  					<!-- 거래중 & 구매목록 -->	
  				<if test="dealMode.equals('buy')">
  					and buyer_id = #{user_id} 
  				</if>
  			</if>
  			<!-- 판매목록 -->
  			<if test="mode.equals('sell')">	
  				and id = #{user_id} 
  			</if>
  			<!-- 구매목록 -->
  			<!-- 에스크로 결제 버튼, qr결제 구매버튼 누를시 buyer_id 넘겨주어야함. -->
  			<if test="mode.equals('buy')">
  				and buyer_id = #{user_id} 
  			</if>
  			<!-- 관심목록 -->
  			<if test="mode.equals('like')">	
  				and idx in
				 	<foreach collection="list" item="item" open="(" close=")" separator=",">
			 			#{item}
					</foreach>
  			</if>	
  			<!-- 후기는 테이블 따로 할지 의논해봐야함. -->		
  		ORDER BY idx DESC) TB) WHERE rNum BETWEEN #{start} AND #{end}
  	</select>
	 
	 
	 
	 <select id="getTotalCount" resultType="int" parameterType="model.ParameterVO">
  		SELECT COUNT(*) from WOO_BOARD 	
  		WHERE idx in
  		 	<foreach collection="list" item="item" open="(" close=")" separator=",">
 			#{item}
		</foreach>	
  	</select>
  	
  	
  	<!-- review table 업데이트 -->
  	<insert id="update_reviewTable" parameterType="model.ParameterVO">
  		insert into woo_review (seller_id, buyer_id, idx, title) values (#{id}, #{user_id}, ${idx},#{title})
  	</insert>
  	
	<update id="update_reviewContents">
		update woo_review set contents = #{0} where idx = #{1}
	</update>
	
	<update id="update_reviewScore">
		update woo_board set review_score = #{0} where idx = #{1}
	</update>
	
</mapper>